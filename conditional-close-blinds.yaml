blueprint:
  name: Conditional Close Blinds
  description: Conditionally close blinds depending on if the window is open. When the window is open, allow cover to close half way, or stay open and automatically close once the window has shut.
  domain: automation
  input:
    cover:
      name: Cover
      selector:
        entity:
          domain: cover
    window_sensor:
      name: Window Sensor
      selector:
        entity:
          domain: binary_sensor
          device_class: window
trigger:
  - platform: sun
    event: sunset
  - platform: state
    entity_id: !input window_sensor
    to: 'off'

# TODO: Condition is sun is lowered
# condition:
  # - condition: state
  #   entity_id: !input window_sensor
  #   state: 'on'

action:
  - service: cover.set_cover_position
    target:
      entity_id: !input cover
    data:
      position: >
        {% if is_state(window_sensor, 'on') %} 50 {% else %} 100 {% endif %}
  - delay:
      seconds: 20
  - service: cover.set_cover_position
    target:
      entity_id: !input cover
    data:
      position: >
        {% if is_state(window_sensor, 'on') -%} 50 {%- else -%} 100 {%- endif %}
